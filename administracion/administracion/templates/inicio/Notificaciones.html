{% extends 'base.html' %}
{% block title %}.:Denuncias:.{% endblock %}
{% block js %}
{% if user.is_authenticated %}
<script type="text/javascript">
$(document).ready(function(){
	Calendar.setup({
		        inputField     :    "id_fecha_presentacion",      // id del campo de texto
		        ifFormat       :    "%Y-%m-%d",       // formato de la fecha, cuando se escriba en el campo de texto
		        button         :    "lanzador"   // el id del botón que lanzará el calendario
		    });
});
</script>
<link rel="stylesheet" type="text/css" media="all" href="{{STATIC_URL}}css/calendar-green.css" title="win2k-cold-1" />
  <script type="text/javascript" src="{{STATIC_URL}}js/calendar.js"></script>
  <script type="text/javascript" src="{{STATIC_URL}}js/calendar-es.js"></script>
  <script type="text/javascript" src="{{STATIC_URL}}js/calendar-setup.js"></script>
<script src="http://maps.google.com/maps/api/js?sensor=true"></script>
{% endif %}
{% endblock %}
{% block contenidos %}
{% if not user.is_authenticated %}
	<h2>Inicie sesion</h2>
	<script type="text/javascript">
	$(document).ready(function(){
		alert('Inicie sesion')
	})
	</script>
	<style type="text/css">
	html{
		display: none;
	}
	</style>
{% else %}
<link rel="stylesheet" type="text/css" href="/static/css/formularios.css">
<script type="text/javascript">
/*$(document).on('ready',verFormulario);
function verFormulario(){
	$('.card').hide();
	$('#not').click(function(){
		$('.card').show(1000);
		$('#not').hide();
	});
}*/
</script>
<script type="text/javascript">
	function ventanaSecundaria(URL){
                window.open(URL,"Editar","width=500,height=300,scrollbars=NO top=150 left=550");
            }
</script>
<!--<button id='not' class="waves-effect waves-light btn">Responder</button>-->
<audio id="player" src="/static/tonos/sonidoUno.mp3"></audio>
<div id="comentario">
{% for mult in multa %}	
	<li><a href="javascript:ventanaSecundaria('/detDenuncias/{{mult.id}}/')">{{ mult.Usuario}}- Notifico:  {{mult.descripcion}}      Cod:{{mult.Codigo}}</a></li>	
{% endfor %}
<li class='cuenta'>Notificaciones registradas hasta la fecha: {{cont}}      <a href="/TodaslasNotificaciones/">Ver Todos</a></li>
</div>
<div id="map_canvas"></div>
<div class="card">
<form method='POST'>{% csrf_token %}
<input type='hidden' name='csrfmiddlewaretoken' value='xVJkmM4l7vuK6cX1520xfqRh3EgHAEEa' />
<input id="id_idUser" name="idUser" value='{{user.id}}' type="hidden">
<tr><th><label for="id_Usuario">Usuario:{{user.username}}</label></th><td>
<input id="id_Usuario" maxlength="100" name="Usuario" type="hidden" value='{{user.username}}' /></td></tr>
<tr><th><label for="id_descripcion">Descripcion:</label>
</th><td><textarea cols="40" id="id_descripcion" name="descripcion" rows="10" required>
</textarea></td></tr>
<tr><th><label for="id_Codigo">Codigo:</label></th>
	<td><input id="id_Codigo" name="Codigo" type="number" required/></td></tr>
<tr><th><label for="id_fecha_presentacion">Fecha presentacion:</label></th><td>
	<input id="id_fecha_presentacion" name="fecha_presentacion" type="text" placeholder='Año-Mes-Dia' />
</td><input type="button" id="lanzador" value="..." /></tr>
<tr><th><label for="id_hora">Hora:</label></th><td>
	<input id="id_hora" maxlength="12" name="hora" type="text" required/></td></tr><br>
<!--class="waves-effect waves-light btn"-->
					<button name='btn' id='boton'>Notificar</button>
</form>
</div>
	<script src="/static/js/jquery.min3.js"></script>
	<script src="http://localhost:3000/socket.io/socket.io.js"></script>
<script>
	$('#map_canvas').text("Cargando Mapa..");
	var socket = io.connect("http://localhost:3000");
	var cont=0;
	$('#boton').on('click',	Notificar);
	//alert('as echo clik en enviars') 
	function Notificar(e){
		e.preventDefault();
		var dato = {
			//user: "{{name}}",
			idUser:$('#id_idUser').val(),
			Usuario:$('#id_Usuario').val(),
			descripcion:$('#id_descripcion').val(),
			Codigo:$('#id_Codigo').val(),
			fecha_presentacion:$('#id_fecha_presentacion').val(),
			hora:$('#id_hora').val()
		}
		if (dato.idUser.length<0 || dato.Usuario.length==0 || dato.descripcion.length<1 || dato.Codigo.length==0 || dato.fecha_presentacion.length==0 || dato.hora.length==0){
			alert('Dejo Campos en blanco Verifique por favor...');
		}
		else{
			socket.emit('notificacion', dato);
			cont=cont+1;
			socket.emit('notificaciones',cont);
			$("#id_descripcion").val("");$("#id_Codigo").val("");$("#id_fecha_presentacion").val("");
			$("#id_hora").val(" ");
		}
	}
	socket.on('devolviendo', function(data){
		var data =JSON.parse(data);
		//alert('escucho el evento devolvien el el cliente');
		$("#comentario").prepend("<p>"+data.Usuario+ "  :Notifico:   " +data.descripcion+"Cod:    "+data.Codigo+"</p>");
		var playing = true;
        $(this).toggleClass("down");
        if (playing == true) {
            document.getElementById('player').play();
        }
        $('.cuenta').html("Notificaciones registradas hasta la fecha:"+data.cont+"<a href='/TodaslasNotificaciones/'>            Ver Todos</a>");
	});
	socket.on('regresandoCooords',DatosCoors);
	function DatosCoors(Coords){
		iniciar(Coords);
	}
	function iniciar(Coords) {
		console.log(Coords.lat);
		console.log(Coords.lng);
		var mapOptions = {
			center: new google.maps.LatLng(Coords.lat, Coords.lng),
			zoom: 15,
			mapTypeId: google.maps.MapTypeId.ROADMAP
		};
		var map = new google.maps.Map(document.getElementById("map_canvas"),mapOptions);
		var pos = new google.maps.LatLng(Coords.lat, Coords.lng);
		marker = new google.maps.Marker({
            position: pos,
            map: map,
            title:"Ubicacion",
            animation: google.maps.Animation.DROP
        });
	}  
	/*$(document).ready(function(){
			socket.on('Avisos', function(data){
			alert(data);
		});
	});*/
</script>
{% endif %}
{% endblock %}

